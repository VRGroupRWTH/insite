#!/bin/bash
# Usage: start_script.sh

source @NEST_INSTALL_PREFIX@/bin/nest_vars.sh
export LD_LIBRARY_PATH=$NEST_MODULE_PATH:/usr/local/lib/:$LD_LIBRARY_PATH

export NEST_SERVER_HOST="${NEST_SERVER_HOST:-0.0.0.0}"
export NEST_SERVER_MODULES="${NEST_SERVER_MODULES:-nest,numpy}"
export NEST_SERVER_PORT="${NEST_SERVER_PORT:-52425}"
export NEST_SERVER_RESTRICTION_OFF="${NEST_SERVER_RESTRICTION_OFF:-1}"
export NEST_SERVER_STDOUT="${NEST_SERVER_STDOUT:-1}"

if [ "$INSITE_DOCKER_USE_NEST_SERVER_MPI" == 1 ]
then
    echo "Running with NEST Server MPI"
    mpirun -np 1 --allow-run-as-root nest-server-mpi --host $NEST_SERVER_HOST
elif [ "$INSITE_DOCKER_USE_NEST_SERVER" == 1 ]
then
    echo "Running with NEST Server"
    nest-server start
else
    echo "Running simulation of the scripted code"
    source run_simulation.sh
fi
